<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Canvas Paint Demo &ndash; Introduction to FRP</title>
    <link rel="stylesheet" href="../reset.css">
    <link rel="stylesheet" href="vendor/highlight/zenburn.css">
    <link rel="stylesheet" href="canvaspaint.css">
  </head>
  <body>
    <div id="content">
      <pre>
        <code>
var canvas = document.getElementById('canvaspaint')
var context = canvas.getContext('2d')

var mouseDowns = Bacon.fromEventTarget(canvas, 'mousedown').doAction('.preventDefault')
var mouseUps = Bacon.fromEventTarget(canvas, 'mouseup').doAction('.preventDefault')
var isPainting = mouseDowns.awaiting(mouseUps).map(toIsPainting)

var mouseMoves = Bacon.fromEventTarget(canvas, 'mousemove')
var paintLines = Bacon.zipAsArray(mouseMoves, mouseMoves.skip(1)).map(toPoints)

resetContext()

paintLines.combine(isPainting, mergeObjects).filter('.isPainting').onValue(paintLine)

function toIsPainting(status) { return { isPainting: status } }

function toPoints(eventPair) {
  return { start: offsetOf(eventPair[0]), end: offsetOf(eventPair[1]) }
}

function offsetOf(event) {
  return {
    x: event.offsetX === undefined ? event.layerX : event.offsetX,
    y: event.offsetY === undefined ? event.layerY : event.offsetY
  }
}

function paintLine(line) {
  context.moveTo(line.start.x, line.start.y)
  context.lineTo(line.end.x, line.end.y)
  context.stroke()
}

// ...
        </code>
      </pre>
      <canvas id="canvaspaint" width="780" height="640"></canvas>
    </div>
    <script src="vendor/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../components/bacon/dist/Bacon.js"></script>
    <script src="canvaspaint.js"></script>
  </body>
</html>
